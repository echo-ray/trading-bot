from feeds.binance import BinanceFeed
from unittest import TestCase, main

depth_msg = {'asks': [['134.10000000', '29.80000000', []],
          ['134.11000000', '4.41300000', []],
          ['134.12000000', '4.19245000', []],
          ['134.13000000', '0.38773000', []],
          ['134.14000000', '16.00000000', []],
          ['134.15000000', '25.20000000', []],
          ['134.18000000', '16.00000000', []],
          ['134.19000000', '20.00000000', []],
          ['134.20000000', '18.13684000', []],
          ['134.21000000', '28.63597000', []],
          ['134.22000000', '136.24999000', []],
          ['134.23000000', '0.10000000', []],
          ['134.25000000', '3.00000000', []],
          ['134.27000000', '0.19000000', []],
          ['134.28000000', '0.18000000', []],
          ['134.30000000', '3.72143000', []],
          ['134.31000000', '0.53539000', []],
          ['134.32000000', '0.11390000', []],
          ['134.33000000', '0.06594000', []],
          ['134.34000000', '1.15294000', []]],
 'bids': [['134.06000000', '0.74574000', []],
          ['134.02000000', '4.00000000', []],
          ['134.00000000', '33.25863000', []],
          ['133.99000000', '49.47798000', []],
          ['133.96000000', '2.16706000', []],
          ['133.95000000', '7.79511000', []],
          ['133.92000000', '8.55210000', []],
          ['133.87000000', '29.97073000', []],
          ['133.86000000', '18.88542000', []],
          ['133.85000000', '2.98841000', []],
          ['133.84000000', '37.35804000', []],
          ['133.78000000', '4.50000000', []],
          ['133.76000000', '1.53600000', []],
          ['133.75000000', '3.59000000', []],
          ['133.74000000', '0.31215000', []],
          ['133.73000000', '55.91798000', []],
          ['133.70000000', '29.87394000', []],
          ['133.69000000', '0.20000000', []],
          ['133.68000000', '1.49200000', []],
          ['133.67000000', '5.18000000', []]],
 'lastUpdateId': 322159833}


class BinanceFeedTest(TestCase):
    def test_bids_asks_from_msg(self):
        feed = BinanceFeed()
        self.assertEqual(
            feed.bids_from_msg(depth_msg),
            depth_msg["bids"]
        )
        self.assertEqual(
            feed.asks_from_msg(depth_msg),
            depth_msg["asks"]
        )

    def test_ask_bid_deleted(self):
        feed = BinanceFeed()
        self.assertTrue(
            feed.ask_bid_deleted(
                ['134.11000000', "0", []]
            )
        )
        self.assertFalse(
            feed.ask_bid_deleted(
                ['134.11000000', '4.41300000', []],
            )
        )


if __name__ == '__main__':
    main()

